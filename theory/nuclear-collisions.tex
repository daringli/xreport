From a macroscopic perspective, nuclei can be viewed as charged particles, and thus collisions (here in a loose sense) between them is essentially governed by the Rutherford scattering formula.
This is how the nucleus was discovered in the first place. However, this simple picture breaks down at higher energies, when the de Broglie wave-length ($\lambda \sim \vec{p}^{-1}$) becomes sufficiently small to resolve the inner structure of the nuclei. At even higher energies, it becomes feasible to model the collision as not taking place between the two nuclei, but by individual protons and neutrons (nucleons).

This leads us to the \emph{participant-spectator} picture of nuclear collisions, in which the collision is viewed as if taking place between a few \emph{participant} nucleons, while the remaining \emph{spectator} nucleons remain mostly unaffected. Such a reaction is known as \emph{quasi-elastic scattering}, since the kinetic energy of the projectile will be much greater than the binding energy of the participants, which further motivates treating them as approximately free particles, and means that the kinetic energy will almost be conserved, hence \emph{quasi-elastic}.
!!!POSSIBLY DISCUSS LIMITATIONS!!!
The collision between the participant nucleons takes place at a time scale of about \unit[$10^{-23}$]{s}\cite{gaimard:1991:art}, and is sometimes called a \emph{fireball} or \emph{firestreak}.

However, this is just the first part of the collision. The participant nucleons may have gone unaffected through it, but the resulting system (a so-called pre-fragment) will be highly excited, and will decay to the actual fragment -- often by ejecting nucleons, in this context known as evaporating them. The characteristic time-scale for these ejections vary between \unit[$10^{-21}$ -- $10^{-16}$]{s}, depending on the energies and emitted particle\cite{gaimard:1991:art}. 

In this picture, we thus have a two-step process to describe nuclear fragmentation. 
Various models to describe both steps exist in the literature, which can be combined more or less freely---they do not necesarilly use the same paremeters to describe the nuclues. Models which mainly use parameters like $A$, the number of nucleons, $Z$ the number of protons, the total nuclear-spin $J$ and the excitation energy $E$ of the nucleus are termed \emph{macroscopic}, while models that directly treat the states of individual nucleons are called \emph{microscopic}. Examples of the former are the \emph{abrasion-ablation model}\cite{bowman:1973:book}, while the \emph{intranuclear-cascade model}\cite{metropolis:1991:art} is an example of a microscopic model. As is often the case in nuclear physics, no one model is valid of all range of nucleon number $A$ and incident energies\cite{cucinotta:1998:art}.

Since the focus on this report is to describe an event-generator for a physics experiment, we do not need a state of the art model (see !!!AUTOREF TO SECTION!!! for the arguments). Since the macroscopic properties of nuclei are more easily related to expermental observables, we will restrict our attention to those. 

\subsection{The fast processes -- the Goldhaber model}
To mimic existing code !!!CITE LEONID?!!! and to allow the user to study a reaction of their interest, the outcome of the first stage of the process is largely determined by user input: the participant projectile nucleons -- the cluster -- as well as its invariant mass, and the excitation energy of the pre-fragment are both specified by user input. The only specific model used is to determine the momentum of the participant system relative to the projectile, everything else is just conservation of momentum, and an isotropic cross-section. 
The \emph{Goldhaber model} states that the momentum distribution is given by a Guassian with the width determined by the expectation value of the momentum of an individual nucleon, explicitly
\begin{equation}
\sigma^2 = \langle \vec{p}^2 \rangle A\frac{A_\text{p}-A}{A_\text{p}-1},
\end{equation}
where $A_\text{p}$ is the number of nucleons in the projectile, $A$ in the pre-fragment, and $\langle \vec{p}^2 \rangle$ is the expectation value of the momentum of an individual nucleon. For a Fermi-gas, $\langle \vec{p}^2 \rangle$ may be written in terms of the Fermi-momentum $\vec{p}_f$ as $\tfrac{3}{5} \vec{p}_f^2$\cite{goldhaber:1974:art}.
!!!THIS IS NOT THE MODEL USED IN LEONID CODE!!!


!!!LEONID USES
\begin{equation*}
\sigma^2 = 2 (M + m -M_p) \frac{mM}{m+M} = 2 Q \mu(m,M),
\end{equation*}
where $m$ is the mass of the participant, $M_p$ the mass of the projectile and $M$ the mass of the pre-fragment. If we take $Q=T = m v^2/2$, we get $\sigma^2 = m^2 v^2$, which could imply that this is just the Fermi-momentum?
!!!

!!!POSSIBLY MOVE NEXT TO CODE DOCUMENTATION, SINCE WHICH FRAME WE USE WHERE IS NOT REALLY GENERAL THEORY!!!
Momentum conservation implies that
\begin{align}
p_\text{p} &= p_\text{i} + q_\text{pf} \\
p_\text{i} + p_\text{t} &= q_\text{i} + q_\text{t}
\end{align}
where $p_\text{p}$ is the 4-momenum of the projectile, $p_\text{t}$ the momentum of the target, $p_\text{i}$ the internal momentum of the cluster; $q_\text{pf}$ the final momenum of the pre-fragment $q_\text{i}$ and $q_\text{t}$ the final momentum of the target and cluster, respectively.

Solving the above equation and squaring for $p_\text{i}$ and squaring gives an expression for the off-shell mass of the cluster as
\begin{equation}
p_\text{i}^2 = p_\text{p}^2 +  q_\text{pf}^2 -  p_\text{p}\cdot q_\text{pf}= m_\text{i}^2 =M_\text{p}^2 + M_\text{pf}^2 - M_\text{p}\sqrt{M_\text{pf} + \vec{p}_i^2},
\end{equation}
where we have evaluated $p_\text{p}\cdot q_\text{pf}$ in the rest-frame of the pre-fragment.

Since we are interested in constructing an event generator, we next transform the cluster's 4-momentum from the projectile to the laboratory frame (the projectile and target momentum is already known in the laboratory frame, the former being zero practically being a definition of that frame). The relevant gamma factor is
$\gamma = 1 + T/m_\text{p}$, where $T$ is the kinetic energy of the projectile.

Since the collision between the target and the cluster is easier to do in their zero-momentum (ZM) frame, we also need to transform between the laboratory and that frame. This is readily done by noting
\begin{equation}
\bar{\vec{P}} = \vec{p}_i + \vec{p}_t = \gamma(\beta_\text{ZM}) \bar{m} \beta_\text{ZM} = \bar{E}\beta_\text{ZM} \implies \beta_\text{ZM} = (\vec{p}_i + \vec{p}_t)/\bar{E},
\end{equation}
where $\bar{E}$ etc. denotes the energy of the system of both particles. Since we want the $\beta$ between the lab and the ZM frame, we evaluate all the quantities in the lab frame
\begin{equation}
\beta_\text{ZM} = \frac{\vec{p}_i}{E_\text{c} + m_\text{t}}. \label{eq:betazm}
\end{equation}

The scattering between target and cluster is back-to-back in the ZM frame, and we generate the scattering angle from an isotropic $\tfrac{d\sigma}{dt}$, which in practice means that the Mandelstam variable $t$ is a uniform random number. The ZM energy, momentum and scattering angle can be readily expressed in term of the invariant Mandelstam variables
\begin{align}
E_\text{c} &= \frac{s+m_\text{i} - m_\text{t}}{2\sqrt{s}} \\
|\vec{p}_\text{c}| &= \sqrt{E_\text{c}^2 - m_\text{i}^2} \\
\cos{\theta} &= \frac{t-m_\text{i}^2-m_\text{c}^2 + 2E_\text{c}^2}{2|\vec{p}_\text{c}|^2}.
\end{align}
A random polar angle $\phi$ in $[0,2\pi]$ is then generated, which together with $|\vec{p}_\text{c}|$, $\theta$ and $E_\text{c}$ fix the ZM 4-momentum of the cluster, and also the target by $\vec{p}_\text{t} = -\vec{p}_\text{c}$. Using \eqref{eq:betazm}, these results are boosted to the lab frame, in which we now have an expression for all the relevant momenta.

\subsection{The slow process -- decay of a compound nucleus}
There are at least two models for the decay of a compound nucleus popular in the literature, the Hauser-Feshbach and the Ewing-Weisskopf formulas. Both aim to describe how a compound nucleus in a given macro-state ($E*$, $J$, $Z$, $A$) will decay.

The older Ewing-Weisskopf formula, which this work is based on, gives the probability of decaying by evaporating a particle $\nu$ as
\begin{equation}
\frac{d^2 P_\nu}{dE_f dt} = \frac{1}{\hbar} \frac{\rho(E_f,J_f)}{\rho(E_i,J_i)} \sum_{S=|J_f-s|}^{|J_f+s|}\sum_{l=|J_i-S|}^{|J_i+S|} T_l(\epsilon_\nu),\qquad\cite{schmidt:1991:art}\label{eq:ew}
\end{equation}
where $P$ is the probability, $E_f$ the final-state energy, $J_f$ the final-state spin, $\rho$ the level densities and $\epsilon_\nu = E_f-E_i-B_\nu$ the kinetic energy of the evaporated particle, $B_\nu$ being its binding energy. 
$s$ is the intrinsic spin of the evaporated particle, $S$ is the spin of the system consisting of the final state nucleus and evaporated particle, with $l$ being the orbital angular momentum of that state with respect to its center of mass. The sums give all the way to couple these while conserving the total angular momentum $\vec{J}_f+\vec{s} +\vec{l}= \vec{S} +\vec{l}= \vec{J}_i$. $T_l$ is the transition probability.
By integrating over $E$, we get $\frac{d P_\nu}{dt} = \Gamma_\nu$, which is roughly proportional to the probability to decay through the channel $\nu$, $P_\nu = \Gamma_\nu/\Gamma_{\text{tot}}$. 

Provided that the characteristic life-time of the system is short compared to the time resolution of the experimental setup, we may essentially treat the decay-widths as probabilities, since -- as far as the experiment is concerned -- the decay may as well take place instantenously. Note that the system may undergo multiple decays before it reaches its ground-state, and that time-scale of this entire decay chain must be short by the experimental standards. The time-of-flight resolution of the future \rtb{} setup will be in the picosecond range (\unit[$10^{-12}$]{s})\cite{r3b:online}, which is well above the time-scales of single evaporation given by Gaimard and Schmidt (\unit[$10^{-21}$ -- $10^{-16}$]{s})\cite{gaimard:1991:art}. Hence we will view $\Gamma_x$ as the probability to decay by a given process in an unspecified but short time step.

Since we are interested in simulating a decay chain, we want more information than merely the probability to decay by emitting a specific particle. We thus take a step back from \eqref{eq:ew}, and undo the summation over $l$
\begin{equation}
\frac{d\Gamma_{\nu,l}}{dE_f} = \frac{1}{\hbar} \frac{\rho(E_f,J_f)}{\rho(E_i,J_i)} \sum_{S=|J_f-s|}^{|J_f+s|} T_l(\epsilon_\nu),\label{eq:ew}
\end{equation}
which finally gives us the decay probability (per unit energy) from an initial state $(E_i,J_i)$ to a final state $(E_f,J_f)$ by emmiting a particle $\nu$ with angular momentum $l$ and momentum given by conservation of energy.

$\nu$ can in principle be any particles. However, the photon must be treated differently as it is massless and thus fully relativistic -- which makes the dististinction between $l$ and the intrinsic spin unnatural -- and removes a polarization state. With this in mind, we get
\begin{align}
&\frac{d\Gamma_{\gamma}}{dE_f} = \frac{1}{\hbar} \frac{\rho(E_f,J_f)}{\rho(E_i,J_i)} \sum_{l=|J_f-J_i|}^{|J_f+J_i|} T_l(\epsilon_\gamma) \\
\implies & \frac{d\Gamma_{\gamma,l}}{dE_f} = \frac{1}{\hbar} \frac{\rho(E_f,J_f)}{\rho(E_i,J_i)} T_l(\epsilon_\gamma),
\end{align}
where $l>0$ is an integer.

Although $\nu$ could be any particle, it becomes more appropriate to model the decay as a fission process if $\nu$ becomes sufficiently heavy in relation to the compound nucleus. Fission is usual modeled as a transition first to a \emph{transition state}, beyond which the nucleus will inevitably fission\cite{krane:book}. The present work does not include fission, and we will thus not discuss its details here. Swiateck discussed the possibility of treating particle emission and fission in an essentially symmetric fashion, by using a transition state formalism also for lighter particles\cite{swiatecki:1983:art}. !!MAY BE INTERESTING TO SAY SOMETHING ABOUT THIS. FIND SOURCE ON WHY THIS APPROACH ISN'T USED.!!

We will now describe models for the level density $\rho$ and transition probability $T_l$.

\subsubsection{Level densities}
The level density $\rho(E,J)$ enumerates the number of levels of a given nucleus in an energy range $[E,E+dE]$ with a given spin $J$. We have in our notation supressed the dependence on $A$ and $Z$. The nuclear level density increases rapidly with energy, and for energies above the threshold for particle evaporation, it is reasonable to approximate it as a continuous function.
We use the following expression
\begin{equation}
\rho(E,J) = \frac{\exp{(\beta U + a/\beta)}(1-\exp{-a/\beta})}{\sqrt{1-\tfrac{1}{2}U\beta\exp{-a/\beta}}} \frac{2J+1}{\sqrt{2}48} \frac{\beta}{U^{3/2}} \frac{1}{\sqrt{\Theta_\perp^2 \Theta_\parallel}}.\label{eq:rho}
\end{equation}

!!!I STILL HAVE NO IDEA WHERE THIS EXPRESSION IS FROM. WRONG NORMALIZATION AND LACKS AN $\exp(-(2J+1)^2\beta/2Theta\_Eff)$ COMPARED TO GROSSJEAN-FELDMEIER, WHICH IT COULD BE GIVEN THE VAGUE COMMENT IN CODEX!!!

Here, $U$ is an effective excitation energy above the \emph{yrast line}, corrected for shell and pairing effects. It is given by
\begin{equation}
U=E_\text{eff} + f(E_\text{eff})\delta S + g(E_\text{eff})\delta P,\label{eq:u}
\end{equation}
where $f$ and $g$ describes the damping of shell and pairing effects with increased energy, and $E_\text{eff} = E*-E_\text{yrast}$. The \emph{yrast energy} is the lowest energy for a given angular momentum, here taken to be
\begin{equation}
E_\text{yrast} = \frac{(2J+1)\hbar^2}{2\Theta_\perp},
\end{equation}
corresponding to a quantum-mechanical axi-symmetric rotor rotating around its symmetry axis. This yrast energy is not strictly speaking the lowest energy for a given $J$, but the energy of a collective rotational excitation, which is a reasonable picture when we have many states with a given $J$ in our energy interval $[E,E+dE]$, which is needed for \eqref{eq:rho} to be valid. !!CITE. THIS IS A GUESS OF MINE.!!

The pairing energy $\delta P$ in \eqref{eq:u} can be estimated from the average separation energy for the surrounding nuclei (in an $(N,Z)$ plot, like an isotope chart), which is close to the actual observed shift between odd and even nuclei\cite{ericson:1960}. Neutrons and protons have different pairing energies, which is to be added or subtracted when neutron or proton number, respectively, is odd or even. 
The shell energy $\delta S$ can either be calculated from a microscopic model, or -- as I have done -- can be be estimated together with the pairing energy by comparing experimental masses with masses predicted by a macroscopic model, and taking the difference, as suggested by Schmidt and Morawek\cite{schmidt:1991:art}. I used the macroscopic part of the 1992 edition of the Finite-Range Droplet Model (FRDM-1992)\cite{moller1995}, which is presented in more detail in \autoref{sec:frdm1995}.

The damping of shell effects with energy can be described by an exponential function
\begin{equation}
f(E_\text{eff}) = 1-\exp{-E_\text{eff}/E_\text{d}},
\end{equation}
where $E_\text{d}$ is the shell-damping energy 
\begin{equation}
E_\text{d} = \frac{0.4}{a} A^{4/3},
\end{equation}
where $a$ is the level-density parameter, which for a spherical nuclei can be approximated by
\begin{equation}
a=\frac{A}{\unit[14.61]{MeV}}(1+3.114 A^{-1/3} + 5.626 A^{-2/3}).\qquad\cite{schmidt:1991:art}\label{eq:a}
\end{equation}
This parameter also enters directly into \eqref{eq:rho}.

Likewise, the damping of pairing effects with energy can also be described by a simple function, in this case
\begin{equation}
g(E_\text{eff}) = \begin{cases} 1-(1-E/E_\text{c})^2 & E_\text{eff} < E_\text{c} \\
 1 & E_\text{eff} \ge E_\text{c}.\qquad\cite{schmidt:1991:art}
\end{cases}
\end{equation}
The critical energy $E_\text{c}$ is approximately $\unit[10]{MeV}$ and varies with angular momentum, 
\begin{equation}
E_\text{c} = \unit[10]{MeV}\sqrt{1-(J/J_\text{c})^2},
\end{equation}
where the critical angular momentum $J_\text{c}$ is about $12\hbar$. !!!SOURCE FOR THIS?!!!

Since we have restricted ourselves to spherical nuclei in \eqref{eq:a}, we also have the moments of inertia $\Theta_\perp = \Theta_\parallel$. In particular, for a sphere with constant density, we have
\begin{equation}
\Theta = \frac{2}{5} M R_0^2 \approx \frac{2}{5} A^{5/3}\times u \times r_0^2
\end{equation}
The approximation is obtained by inserting $R_0 = r_0 A^{1/3}$ and $M=u A$, where $r_0=\unit[1.16]{fm}$ is the nuclear radius constant, with the same value as in the macroscopic model\cite{moller1995}. $u$ is the atomic mass units, $u \approx \unit[931.5]{MeV}$.

Finally, $\beta$ in \eqref{eq:rho} is the reciprocal nuclear temperature $\beta=1/T$. It can be calculated from $\tfrac{a}{\beta}$, which is obtained by solving
\begin{equation}
a/\beta=\sqrt{(aU)[1 -exp{-a/\beta}]},\qquad\cite{grossjean1985}\label{eq:abiteration}
\end{equation}
which can be done numerically by iterating
\begin{equation}
(a/\beta)_{n+1}=\sqrt{aU[1 -exp{-(a/\beta)_n}]}
\end{equation}
from a suitable initial guess $(a/\beta)_{0}$. $(a/\beta)_{0}=\sqrt{aU}$ was used here, which solves \eqref{eq:abiteration} for $(a/\beta) \to \infty$ and known to be a good initial guess\cite{grossjean1985}.

\subsubsection{Transition Probabilities}
The decay width $\Gamma_{\nu,l}$ into a given final energy interval $[E_f,E_f+dE]$ by particle $\nu$ with orbital angular orbital momentum $l$ also depends on the transition probability $T_l(\epsilon_\nu)$.

One of the more well-known models of a transition probability by particle decay is the Gamow model for alpha decay, in which the mother nucleus $(Z,N)$ is modeled as essentially being composed of a ready-to-go alpha particle and the daughter nucleus $(Z-2,N-2)$ and the probability to decay is essentially given by the probability for the alpha particle to tunnel through the potential due to the daughter nucleus, with an additional factor depending on how often the alpha particle has a chance to tunnel. 

This model is readily generalized to other particle decays: we may just as well imagine a proton being formed inside the mother nucleus $(Z,N)$, and tunneling through the potential from the daughter nucleus $(Z-1,N)$.

In order to make this model quantitative, we need an actual potential. Approximating the charge distribution of the daughter and tunneling particle as spherical, we may model the potential due to electrostatic interaction as a simple Coulomb potential, which gives us
\begin{equation}
V = V_\text{Col} + \dots =  Z_1 Z_2 \frac{e^2}{r_{12}} + \dots,
\end{equation}
in non-rationalized units.
If we go ahead and assume that not only the charge distribution, but the potential as a whole is spherically symmetric, we can employ the standard procedure of splitting up the problem into a radial and angular part, where the radial potential is given by
\begin{equation}
V_\text{r} = Z_1 Z_2 \frac{e^2}{r_{12}} + \frac{l(l+1)\hbar^2}{2\mu r^2} + \dots
\end{equation}
where we still need additional terms to take into account the effective nucleon-nucleon intraction. The assumption of spherical symmetry also gives us the angular part of the wave function as a spherical harmonic, which gives us the angular distribution of the emitted particle in the center-of-mass frame.

The nuclear part of the potential used by \prgname{Codex} is a proximity potential\cite{gollerthan:1988:thesis}\cite{blocki1977}. 

!!! WRITE SOMETHING GENERAL ABOUT THE MODEL ASSUMPTIONS... I DON'T REALLY SEE HOW THIS APPLIES TO NEUTRONS OR PROTONS, BUT PEOPLE APPLY IT TO ALPHAS, WHICH ISN'T THAT FAR OFF IN TERMS OF NUCLEON NUMBER... !!!

The potential is given by
\begin{equation}
V_\text{N} = C \phi(\zeta),\label{eq:vn}
\end{equation}
where
\begin{equation}
\phi(\zeta)= \begin{cases}-0.5(\zeta-2.54)^2-0.0852(\zeta-2.54)^3 & \zeta < 1.2511 \\
-3.437\exp{(-\zeta/0.75)} & \zeta > 1.2511.\qquad\cite{blocki1977}
\end{cases}
\end{equation}
$\zeta$ is a dimensionless distance between the two nuclear surfaces, normalized with respect to the typical surface diffuseness of the nuclei, here taken to be $\unit[1]{fm}$\cite{blocki1977}. More explicitly, we have
\begin{equation}
\zeta = \frac{r - r_\text{sum}}{b},
\end{equation}
where $b$ is the surface diffuseness, and $r_\text{sum}$ is roughly the sum of the radii of the two nuclei, so that $r-r_\text{sum}$ gives the distance between the nuclear surfaces\cite{blocki1977}. The effective sharp nuclear surface may be estimated by the formula
\begin{equation}
r_\text{sharp} = 1.28 A^{1/3} - 0.76 + 0.8 A^{-1/3}\quad\units{fm},\qquad\cite{blocki1977}\label{eq:sharp}
\end{equation}
which in \prgname{CODEX} is adjusted by adding a radius correction constant, $r_\text{adj} = \unit[0.9]{fm}$.
\eqref{eq:sharp} is used to estimate the radii of all nuclei, and as a result $r_\text{sharp}=\unit[1.32]{fm}$ for protons and neutrons -- with the radius correction, this gives an $r_\text{sharp}=\unit[2.22]{fm}$, about three times the experimental charge radius of the proton!
!!!  THE INPUT FILE SAYS ``VAZ ET. AL.'' NEXT TO RADIUS CORRECTION. WHAT IS THIS? !!!
In the proximity potential, it is preferable to use the \emph{central radius} $r_\text{c}$ rather than the effective sharp radius\cite{blocki1977}, which is given by 
\begin{equation}
r_\text{c} =r_\text{sharp} \left(1-\left(\trfac{b}{r_\text{sharp}}\right)^2\right)\quad.\qquad\cite{myers1973}
\end{equation}
Hence, $r_\text{sum} = r_\text{c,1}+r_\text{c,2}$, and the only unknown constant in \autoref{eq:vn} is the proportionality constant $C$, which depends on the shape of the interacting nuclei, 
\begin{equation}
C = 4\pi \gamma b \frac{r_{c,1} r_{c,2}}{r_{c,1} + r_{c,2}}
\end{equation}
where $\gamma$ is the surface energy coefficient, which can be approximated by
\begin{equation}
\gamma= 0.9517 (1.0 - 1.78260 \times I^2),
\end{equation}
where $I=(N-Z)/A$ is the neutron excess.
!!!THIS WILL BE MORE CLEAR ONCE I WRITE SOMETHING GENERAL ABOUT THE MODEL, WHICH REALLY DEALS WITH BULK AND SURFACE ENERGIES OF A THIN-SKINNED SYSTEM.!!!

Given the potential, the transition probability

\paragraph{\gamma-decay}
The above discription concerned the tunneling of a nucleon or cluster through a potential barrier, and is thus not applicable to gamma decay.